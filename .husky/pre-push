# .husky/pre-push
#!/bin/sh

# Prevenir push direto para main
current_branch=$(git symbolic-ref --short HEAD)
remote="$1"

# Extrai o nome do autor do commit do ambiente, se definido pelo semantic-release
commit_author_name="$GIT_AUTHOR_NAME"

# Verifica se o commit est√° sendo feito pelo semantic-release
# O nome do autor pode ser personalizado na configura√ß√£o do @semantic-release/git
is_semantic_release=false
if [ "$commit_author_name" = "semantic-release-bot" ]; then
  is_semantic_release=true
fi

# Se tentando push para origin/main
if [ "$remote" = "origin" ] && [ "$is_semantic_release" = "false" ] && [ "$current_branch" = "main" ]; then
  echo "‚ùå ERRO: Push direto para 'main' n√£o √© permitido!"
  echo ""
  echo "üìã Fluxo correto:"
  echo "   1. Crie uma branch: git checkout -b feat/nova-funcionalidade"
  echo "   2. Fa√ßa commits nela"
  echo "   3. Envie para o reposit√≥rio: git push origin feat/nova-funcionalidade"
  echo "   4. Abra um Pull Request no GitHub"
  echo ""
  echo "üîó Documenta√ß√£o: https://github.com/Micael-Macedo/opalbytes-directive-components/blob/main/README.md#-estrat√©gia-de-branches"
  exit 1
fi

npm test
